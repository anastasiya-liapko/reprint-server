"use strict";!function(o){var e,i,s,d,l,r,n,t=0,c=!1,u=[],v={},m={},p=0;var f={};function y(e,t,a,r){var n=e.val();if("phone"==a)/\+7[0-9]{10}/.test(n)?u[t]=!0:(u[t]=!1,f[t]={name:a,error:"Введите номер телефона в формате +1234567890"});else if("email"==a){/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)?u[t]=!0:(u[t]=!1,f[t]={name:a,error:"Введите e-mail в формате default@mail.com"})}else 2<n.length?u[t]=!0:(u[t]=!1,f[t]={name:a,error:"Это обязательное поле"});r&&(u[t]?(e.removeClass("error"),void 0!==f[t]&&o("#cartFormValid-"+f[t].name).text("")):(e.addClass("error"),void 0!==f[t]&&o("#cartFormValid-"+f[t].name).text(f[t].error))),h()}function h(){for(var e=!0,t=0;t<u.length;t++)0==u[t]&&(e=!1);e?(r.removeClass("disabled"),r.prop("disabled",!1)):(r.addClass("disabled"),r.prop("disabled",!0))}o.startCart=function(){e=o("#cartForm"),i=o("#modCartQuantity"),s=o("#modCartTotal"),d=o("#sumDelivery"),l=o("#itogo"),e.find("input.quantity_js").on("keypress",function(e){var t=(e=e||window.event).which?e.which:e.keyCode;return!(31<t&&(t<48||57<t))}),e.find("select.adv_params_js, input.quantity_js").on("change keyup",function(){clearTimeout(t),t=setTimeout(function(){e.submit()},1300)}),o("#delivery-type").on("change",function(){var e;e=o(this),c||(c=!0,o.ajax({type:"POST",cache:!1,dataType:"json",url:"/index.php?controller=cart&action=change_delivery",data:{delivery_type:e.val()}}).done(function(e){e.status&&(s.text(e.itogo),d.text(e.sumDelivery),l.text(e.itogo))}),c=!1)}),o("#modalDelete").on("shown.bs.modal",function(e){var a=o(e.relatedTarget),r=a.data("key"),n=o(this);o("#yesDelete").on("click",function(){var e,t;n.modal("hide"),e=r,t=a,c||(c=!0,o.ajax({type:"POST",cache:!1,dataType:"json",url:"/index.php?controller=cart&action=delete_product",data:{delete:e}}).done(function(e){e.status&&(i.text(e.quantity),s.text(e.itogo),d.text(e.sumDelivery),l.text(e.itogo),t.parents("div.order__item").remove())}),c=!1)})}),function(){var e=["name","address","phone","email","delivery-type"];r=o("#send");for(var t=0;t<e.length;t++){var a=o("#"+e[t]);y(a,t,e[t],!1),function(e,t,a){t.on("change blur keyup",function(){y(t,e,a,!0)})}(t,a,e[t])}h()}()},o.startBookPage=function(e,t){n=o("#priceItem"),m=e,p=parseFloat(t);var a=o("select.adv_params_js");a.each(function(){var e=o(this),t=e.attr("name");v[t]=e}),a.on("change",function(){!function(){var e=p;for(var t in v){var a=v[t].val();void 0!==m[t]&&void 0!==m[t][a]&&(e+=parseFloat(m[t][a]))}n.text(e)}()})}}(jQuery);